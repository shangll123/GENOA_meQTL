
```R
#-------------------------------
# extract_snp_names_Apr.r
#-------------------------------

args <- as.numeric(commandArgs(TRUE))
i=args[1]
k=args[2]
print(i)

path_genotype="/home/skardia_lab/clubhouse/research/projects/GENOA_AA_mQTL/lulu/data/genotype"
path_chunk = "/home/skardia_lab/clubhouse/research/projects/GENOA_AA_mQTL/lulu/data/chunk"
path_SNP = "/home/skardia_lab/clubhouse/research/projects/GENOA_AA_GE/preprocessing_zxu_March2017/Lulu_Mar2018/APT_results/SNP_file"

load(paste0(path_genotype,"/all_filtered.chr",i,".RData"))
cpg_map = read.table(paste0(path_chunk,"/cpg_map_chr_",i,"_chunk_",k,".txt"))
			
snp_pos=snp_chr_use$V4
snp_nameonchr=as.character(snp_chr_use$V3)	

start=cpg_map$V3-50000
end  =cpg_map$V4+50000

num = c()
for( g in 1:dim(cpg_map)[1]){
	print(g)
	temp_index <- which(snp_pos >= start[g] &  snp_pos <= end[g] )
	snp_name= as.character(snp_nameonchr[temp_index])
	name=snp_name
	cpgname = as.character(cpg_map$V1)[g]
	num[g] = length(name)
	fn=paste0(path_genotype,"/chr_", i, "/chr_",i,"_",cpgname,".snpname", sep = "")
	write.table(name, file=fn, quote = F, row.names = F, col.names = F)
}

print(summary(num))

```

#### 
```bash
#=========================
plinkcisSNP.sh
#=========================

#!/bin/bash -l

#$ -N cisSNP
#$ -j y

echo $FOO 
echo $SGE_TASK_ID
mylines=$FOO
pathchunk=/home/skardia_lab/clubhouse/research/projects/GENOA_AA_mQTL/lulu/data/chunk
pathlulu=/home/skardia_lab/clubhouse/research/projects/GENOA_AA_mQTL/lulu

i=$(awk -v mylines=$mylines 'NR==mylines {print $1}'  ${pathchunk}/dictionary.txt)
j=$(awk -v mylines=$mylines 'NR==mylines {print $2}'  ${pathchunk}/dictionary.txt)
num=$(awk -v mylines=$mylines 'NR==mylines {print $3}'  ${pathchunk}/dictionary.txt)
echo $i
echo $j
echo $num

mkdir ${pathchunk}/chr_${i}_chunk_${j}
cd ${pathchunk}/chr_${i}_chunk_${j}
cpginfo=${pathchunk}/cpg_map_chr_${i}_chunk_${j}.txt
Gfile=${pathlulu}/data/genotype/AA/mQTL_chr_${i}

for ((line=1;line<=num;line++)); do
echo $line
cpgname=$(awk -v line=$line 'NR==line {print $1}'  $cpginfo)
snpname=${pathlulu}/data/genotype/AA/chr_${i}/chr_${i}_${cpgname}.snpname
plink --noweb --bfile ${Gfile}  --extract ${snpname} --make-bed --out ${cpgname}
done
rm *.log
rm *.nosex
cd ..
tar -czf chr_${i}_chunk_${j}.tar.gz --remove-files chr_${i}_chunk_${j}



```









